# 命令行操作教程（Windows）

本文提供可直接照做的 Git 上传/下载操作：本地纯 Git 演示和 GitHub 实战（SSH）。

## 一、环境准备
- 检查 Git：`git --version`
- 设置身份（显示在提交记录）：
  - `git config --global user.name "你的名字"`
  - `git config --global user.email "你的邮箱"`

## 二、快速本地演示（无网络）
在 `e:\StudyDevelopment-Journey\Git` 下完整走一遍 push/clone/pull。

1) 创建一个“裸仓库”（充当远端）：
```powershell
mkdir e:\StudyDevelopment-Journey\Git\remote-demo.git
git init --bare e:\StudyDevelopment-Journey\Git\remote-demo.git
```

2) 初始化项目并首次提交：
```powershell
mkdir e:\StudyDevelopment-Journey\Git\demo-app
cd e:\StudyDevelopment-Journey\Git\demo-app
git init
"# 本地演示项目" | Out-File -Encoding UTF8 README.md（powershell) echo # 本地演示项目 > README.md (cdm)
#安全处理
# 如果要在整个开发目录工作，添加父目录
git config --global --add safe.directory E:/StudyDevelopment-Journey/Git
# 或者添加所有子目录
git config --global --add safe.directory "E:/StudyDevelopment-Journey/Git/*"

git config --add safe.directory .

git add README.md
git commit -m "初始化项目，添加 README"
```

3) 关联远端并首次上传：
```powershell
git remote add origin e:\StudyDevelopment-Journey\Git\remote-demo.git
git branch -M main
git push -u origin main
```

4) 模拟“下载”：从该远端克隆到新目录：
```powershell
cd e:\StudyDevelopment-Journey\Git
git clone e:\StudyDevelopment-Journey\Git\remote-demo.git demo-app-clone
```

5) 在克隆目录修改并再次上传：
```powershell
cd e:\StudyDevelopment-Journey\Git\demo-app-clone
"演示第二次提交" | Add-Content README.md
git add README.md
git commit -m "更新 README，演示二次提交"
git push
```

6) 回到原项目拉取更新：
```powershell
cd e:\StudyDevelopment-Journey\Git\demo-app
git pull
```

完成后，你已体验：`push`（上传）、`clone`（下载新副本）、`pull`（拉更新）。

## 三、GitHub 实战（SSH免密）
1) 在 GitHub 新建仓库（如 `my-first-repo`），记住 SSH 地址：`git@github.com:<你的用户名>/my-first-repo.git`

2) 生成 SSH 密钥（一路回车）：
```powershell
ssh-keygen -t ed25519 -C "你的邮箱"
```
公钥在：`C:\Users\<你的Windows用户名>\.ssh\id_ed25519.pub`，复制内容到 GitHub：Settings → SSH and GPG keys → New SSH key。

3) 测试连接：
```powershell
ssh -T git@github.com
```
输入 `yes` 后出现欢迎语即成功。

4) 关联并上传：
```powershell
cd e:\StudyDevelopment-Journey\Git\demo-app
git remote add origin git@github.com:<你的用户名>/my-first-repo.git
git branch -M main
git push -u origin main
```

如因变基/重写历史需要覆盖远端，请使用更安全的强制推送：

```powershell
# 覆盖远端当前分支（更安全，避免误覆盖他人提交）
git push --force-with-lease
# 指定分支与远端
git push --force-with-lease origin main
```
仅在你明确需要让远端历史与本地重写后的历史一致时使用强制推送；协作仓库务必先沟通。

# 无条件强制推送，可能丢失团队成员的提交
git push --force origin main

# 强制推送所有分支
git push --all --force

# 强制推送标签
git push --tags --force

5) 下载（克隆到新目录）：
```powershell
cd e:\StudyDevelopment-Journey\Git
git clone git@github.com:<你的用户名>/my-first-repo.git my-first-repo
```

6) 拉取更新：
```powershell
cd e:\StudyDevelopment-Journey\Git\my-first-repo
git pull
git pull origin main （--allow-unrelated-histories）允许合并无关历史
```

若用 HTTPS，远端形如 `https://github.com/<你的用户名>/my-first-repo.git`，首次 `git push` 时用 PAT 作为密码。

## 四、常用命令速查
- 查看状态：`git status`
- 提交记录：`git log --oneline --graph --decorate`
- 新分支/切换：`git checkout -b feature-x`，`git switch main`
- 拉取（合并）：`git pull`
- 拉取（变基）：`git pull --rebase`
- 设置上游：`git push -u origin <分支>`
- 修改上一提交说明：`git commit --amend`
- 暂存未提交改动：`git stash`，恢复：`git stash pop`

### 查看类命令补充
- 简洁状态：`git status -sb`
- 远端列表：`git remote -v`
- 分支与上游：`git branch -a -vv`
- 标签列表：`git tag -n`
- 提交历史细节：`git log --stat --graph --oneline --decorate`
- 查看某文件改动：`git log -p -- <路径>`，或 `git blame <文件>`
- 查看某次提交：`git show <commit>`，含文件统计：`git show --stat <commit>`
- 比较改动（工作区/暂存区）：`git diff`，`git diff --staged`
- 指定范围比较：`git diff HEAD~1..HEAD`，仅列文件：`git diff --name-only`
- 引用日志（找回丢失的提交）：`git reflog`
- 当前索引/树内容：`git ls-files`，`git ls-tree -r HEAD --name-only`
- 描述当前提交：`git describe --tags --always`
- 获取当前 SHA：`git rev-parse --short HEAD`
- 忽略规则检查：`git check-ignore -v <文件>`
- 储藏查看：`git stash list`，查看具体储藏：`git stash show -p stash@{0}`
- 作者统计：`git shortlog -sn`
- 本地与上游差异：`git cherry -v`
- 配置查看：`git config --list --show-origin`
- 子模块状态（如有）：`git submodule status`

## 五、分支与冲突快速示例
1) 创建分支并提交：
```powershell
git checkout -b feature-docs
# 修改文件...
git add .
git commit -m "完善文档"
git push -u origin feature-docs
```

2) 合并到 main：
```powershell
git switch main
git pull --rebase
git merge feature-docs
git push
```

3) 若冲突：
- 打开冲突文件，保留正确内容；
- `git add <冲突文件>` 后 `git commit` 完成合并；
- `git push` 推送。

六、删除命令

- 删除已跟踪文件并记录删除：`git rm <文件>`；删除目录：`git rm -r <目录>`
- 仅从版本库删除但保留本地文件：`git rm --cached <文件>`（常与 `.gitignore` 配合）
- 误删恢复到最新提交：`git restore --source=HEAD -- <文件>`（旧法：`git checkout -- <文件>`）
- 清理未跟踪文件/目录：演练：`git clean -nd`；实际：`git clean -fd`（含忽略：`-fx`，谨慎）
- 删除本地分支：`git branch -d <分支>`（强制：`git branch -D <分支>`）
- 删除远端分支：`git push origin --delete <分支>` 或 `git push origin :<分支>`
- 删除标签：本地 `git tag -d <标签>`；远端 `git push origin :refs/tags/<标签>`
- 删除远端：`git remote remove <名称>`（或 `git remote rm <名称>`）
- 撤销提交不等于删除：安全回滚用 `git revert <commit>`；重写历史：`git reset --hard <commit>`（协作慎用）。

### 删除提交（重写历史）
- 删除最近一次提交：
  - 保留改动并暂存：`git reset --soft HEAD~1`
  - 保留改动到工作区：`git reset --mixed HEAD~1`
  - 丢弃改动并回退：`git reset --hard HEAD~1`
- 删除最近 N 次提交：`git reset --hard HEAD~N`
- 删除中间某些提交：`git rebase -i <基底>`，在弹出的列表中删除对应行或标记为 `drop`，保存并按照提示继续。
- 远端历史同步：本地重写后用更安全的强制推送同步远端：`git push --force-with-lease` 或 `git push --force-with-lease origin <分支>`。
- 误删找回：用 `git reflog` 找到之前的提交指针，然后 `git reset --hard <reflog项的SHA>` 恢复。

七、创建和合并

- 创建分支：`git switch -c <分支>` 或 `git checkout -b <分支>`
- 推送并设上游：`git push -u origin <分支>`
- 合并到当前：`git merge <分支>`；仅快进：`git merge --ff-only`；禁止快进：`git merge --no-ff`
- 变基到目标：`git rebase <目标分支>`；继续：`git rebase --continue`；取消：`git rebase --abort`
- 挑拣提交：`git cherry-pick <commit>`（支持区间/多个）
- 先同步再合并/变基：`git fetch origin` 后 `git merge origin/<分支>` 或 `git rebase origin/<分支>`
- 冲突流程：编辑 → `git add` → `git commit`；查看提示：`git status`

八、修改

- 分块暂存：`git add -p`；取消暂存：`git restore --staged <文件>` 或 `git reset HEAD <文件>`
- 修改上一提交：`git commit --amend`；只改说明：`git commit --amend --no-edit`
- 重写多个提交：`git rebase -i HEAD~N`（squash/fixup 合并）
- 回滚某次改动：`git revert <commit>`；回滚范围：`git revert <A>..<B>`
- 恢复文件到指定版本：`git restore --source <commit> -- <路径>`；或 `git checkout <commit> -- <路径>`
- 重命名/移动：`git mv <旧> <新>`
- 搁置与恢复：`git stash` / `git stash pop`；查看：`git stash list` / `git stash show -p`
- 更新作者信息：`git config user.name "你的名字"`；`git config user.email "你的邮箱"`（全局加 `--global`）

九、其他（Git 进阶）

- 多工作树：`git worktree add ../wt-main main`
- 稀疏检出：`git sparse-checkout init`，`git sparse-checkout set <目录>`
- 子模块：`git submodule add <仓库> <路径>`；`git submodule update --init --recursive`
- 二分定位：`git bisect start` → `git bisect bad` / `git bisect good` → `git bisect reset`
- 维护检查：`git gc`、`git fsck`、`git prune`
- 补丁与应用：`git format-patch -n`、`git apply <补丁文件>`
- 打包导出：`git archive -o source.zip HEAD`
- 同步清理引用：`git fetch --all --prune`
- 安全覆盖推送：`git push --force-with-lease`
- 钩子：`.git/hooks`（如 `pre-commit`）用于本地自动化。

## 十、命令行操作符速查（Windows）

### PowerShell 常用操作符
- `|` 管道：把上一命令的输出对象传递给下一命令。例如：`git log --oneline | Select-Object -First 5`
- `>`、`>>` 重定向标准输出到文件（覆盖/追加）。例如：`git status > status.txt`
- `2>`、`2>>` 重定向错误输出到文件；`*>`、`*>>` 重定向所有流。
- `;` 语句分隔：在一行顺序执行多个命令。
- `*`、`?` 通配符：`Get-ChildItem *.md`、`Get-ChildItem src?`。
- `&&`、`||`（PowerShell 7+ 支持）：按上一命令成功/失败决定是否执行下一条，例如：`git fetch && git status`。在 Windows PowerShell 5.1 可用 `; if ($LASTEXITCODE -eq 0) { ... }` 模拟。
- 反引号 `` ` `` 转义/续行：长命令可换行。
- 引号：`"` 支持变量插值，`'` 原样字符串。示例：`git commit -m "修复：空格处理"`。

### CMD 常用操作符
- `|` 管道：把文本输出传给下一命令，例如：`git diff --name-only | findstr /E ".md"`
- `>`、`>>` 重定向标准输出；`2>` 重定向错误输出；`2>&1` 合并错误到标准输出。
- `&` 顺序执行；`&&` 前一命令成功才继续；`||` 前一命令失败才继续。
- `^` 转义特殊字符：`^|`、`^&`、`^>` 等。
- `*`、`?` 通配符；`()` 分组与统一重定向：`(dir & echo done) > out.txt`。
- 环境变量：`%VAR%` 引用，例如：`echo %USERNAME%`。

### 组合示例
- 快速查看并保存日志：`git log --oneline -n 20 > log.txt`
- 仅查看 Markdown 的改动文件（CMD）：`git diff --name-only | findstr /E ".md"`
- 成功拉取后才展示状态（PowerShell 7+）：`git pull && git status`